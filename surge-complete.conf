# ============================================
# Surge 完整配置文件
# 适用于 Mac + iPhone 双平台
# 白名单模式 | AI优化 | 广告拦截 | Apple优化
# 更新日期: 2026-01-11
# ============================================

[General]
# ==================== 基础设置 ====================
# 日志等级: warning, notify, info, verbose
loglevel = notify

# 跳过代理的内网地址
skip-proxy = 127.0.0.1, 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 100.64.0.0/10, 17.0.0.0/8, localhost, *.local, *.crashlytics.com, seed-sequoia.siri.apple.com, sequoia.siri.apple.com, sequoia.apple.com, passenger.t3go.cn, www.baidu.com, yunbusiness.ccb.com, wxh.wo.cn, gate.lagou.com, www.abchina.com.cn, www.shanbay.com, login-service.mobile-bank.psbc.com, mobile-bank.psbc.com

# 排除简单主机名
exclude-simple-hostnames = true

# ==================== 网络测试 ====================
# 国内网络测试 URL
internet-test-url = http://www.baidu.com
# 代理测试 URL
proxy-test-url = http://cp.cloudflare.com/generate_204
# 测试超时时间
test-timeout = 3

# ==================== DNS 设置 ====================
# DNS 服务器
dns-server = 223.5.5.5, 223.6.6.6, 119.29.29.29, 114.114.114.114, system
# 加密 DNS
encrypted-dns-server = https://dns.alidns.com/dns-query, https://doh.pub/dns-query
# 跳过加密 DNS 的域名
encrypted-dns-skip-cert-verification = true

# ==================== IPv6 设置 ====================
ipv6 = false
ipv6-vif = disabled

# ==================== 其他设置 ====================
# GeoIP 数据库
geoip-maxmind-url = https://github.com/Hackl0us/GeoIP2-CN/raw/release/Country.mmdb

# 允许 Wi-Fi 访问 (iOS)
allow-wifi-access = true
wifi-access-http-port = 6152
wifi-access-socks5-port = 6153

# 允许热点共享
allow-hotspot-access = true

# 兼容性模式
compatibility-mode = 0

# 显示错误页面
show-error-page-for-reject = true

# UDP 流量转发
udp-priority = true

# 始终使用真实 IP 的域名
always-real-ip = *.lan, cable.auth.com, *.msftconnecttest.com, *.msftncsi.com, network-test.debian.org, detectportal.firefox.com, resolver1.opendns.com, *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, stun.*, localhost.*.qq.com, *.logon.battlenet.com.cn, *.logon.battle.net, *.blzstatic.cn, *.googleapis.com, generativelanguage.googleapis.com, ai.google.dev

# Hijack DNS
hijack-dns = *:53

# ==================== HTTP/HTTPS 引擎 ====================
http-listen = 0.0.0.0:6152
socks5-listen = 0.0.0.0:6153

# 外部控制器
external-controller-access = surgepasswd@0.0.0.0:6170

# ==================== 复制到剪贴板 ====================
# 用于 URL Scheme 调用
# surge:///install-config?url=YOUR_CONFIG_URL


# ============================================
# 代理节点
# ============================================
[Proxy]
# 内置策略 DIRECT、REJECT、REJECT-TINYGIF 不需要定义，Surge 已内置

# ============================================
# 代理策略组
# ============================================
[Proxy Group]
# ==================== 主策略组 ====================
# 节点选择 - 手动选择代理节点
节点选择 = select, 自动选择, 香港节点, 台湾节点, 日本节点, 新加坡节点, 美国节点, 我的节点, DIRECT

# 自动选择 - 自动测速选择最快节点
自动选择 = url-test, include-other-group=我的节点, url=http://cp.cloudflare.com/generate_204, interval=300, tolerance=50

# ==================== 功能策略组 ====================
# AI 服务 - 走美国节点
AI服务 = select, 美国节点, 节点选择, 香港节点, 日本节点, 新加坡节点, 台湾节点

# Apple 服务
Apple服务 = select, DIRECT, 节点选择, 美国节点, 香港节点, 日本节点

# 国际媒体
国际媒体 = select, 节点选择, 香港节点, 台湾节点, 日本节点, 新加坡节点, 美国节点

# 电报消息
Telegram = select, 节点选择, 香港节点, 新加坡节点, 美国节点, 日本节点

# 微软服务
Microsoft = select, DIRECT, 节点选择, 美国节点, 香港节点

# 游戏平台
游戏平台 = select, DIRECT, 节点选择, 香港节点, 日本节点, 台湾节点

# 广告拦截
广告拦截 = select, REJECT, DIRECT

# 兜底策略
Final = select, 节点选择, DIRECT, 自动选择

# ==================== 地区节点组 ====================
# 香港节点
香港节点 = smart, include-other-group=我的节点, update-interval=0, no-alert=0, hidden=0, include-all-proxies=0, policy-regex-filter=(🇭🇰)|(香港)|(Hong)|(HK)

# 美国节点
美国节点 = smart, include-other-group=我的节点, update-interval=0, no-alert=0, hidden=0, include-all-proxies=0, policy-regex-filter=(🇺🇸)|(美国)|(States)|(US)

# 日本节点
日本节点 = smart, include-other-group=我的节点, update-interval=0, no-alert=0, hidden=0, include-all-proxies=0, policy-regex-filter=(🇯🇵)|(日本)|(Japan)|(JP)

# 台湾节点
台湾节点 = smart, include-other-group=我的节点, update-interval=0, no-alert=0, hidden=0, include-all-proxies=0, policy-regex-filter=(🇹🇼)|(台湾)|(Tai)|(TW)

# 新加坡节点
新加坡节点 = smart, include-other-group=我的节点, update-interval=0, no-alert=0, hidden=0, include-all-proxies=0, policy-regex-filter=(🇸🇬)|(新加坡)|(Singapore)|(SG)

# ==================== 订阅节点 ====================
# Sub-Store 订阅
我的节点 = select, policy-path=https://sub.store/download/collection/ALL?target=Surge, update-interval=86400, no-alert=0, hidden=0, include-all-proxies=0


# ============================================
# 分流规则
# ============================================
[Rule]
# ==================== 规则优先级说明 ====================
# 规则按从上到下的顺序匹配，匹配到即停止
# 建议顺序：去广告 > AI服务 > 特殊规则 > 国内直连 > 国际代理 > 兜底

# ==================== 广告拦截 ====================
# 广告拦截规则集
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Advertising/Advertising_Domain.list,广告拦截,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Advertising/Advertising.list,广告拦截,extended-matching

# 隐私保护
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Privacy/Privacy.list,广告拦截,extended-matching

# 反劫持
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Hijacking/Hijacking.list,广告拦截,extended-matching

# ==================== AI 服务（优先级最高）====================
# OpenAI / ChatGPT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/OpenAI/OpenAI.list,AI服务,extended-matching

# Claude / Anthropic
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Claude/Claude.list,AI服务,extended-matching

# Google Gemini / AI Studio
DOMAIN-SUFFIX,generativelanguage.googleapis.com,AI服务
DOMAIN-SUFFIX,ai.google.dev,AI服务
DOMAIN-SUFFIX,aistudio.google.com,AI服务
DOMAIN-SUFFIX,makersuite.google.com,AI服务
DOMAIN-SUFFIX,bard.google.com,AI服务
DOMAIN-SUFFIX,gemini.google.com,AI服务
DOMAIN-SUFFIX,deepmind.com,AI服务
DOMAIN-SUFFIX,deepmind.google,AI服务
DOMAIN-SUFFIX,aiplatform.googleapis.com,AI服务
DOMAIN-SUFFIX,ml.googleapis.com,AI服务
DOMAIN-SUFFIX,vertex-ai.googleapis.com,AI服务

# Copilot / Bing AI
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Copilot/Copilot.list,AI服务,extended-matching

# Perplexity
DOMAIN-SUFFIX,perplexity.ai,AI服务

# Poe
DOMAIN-SUFFIX,poe.com,AI服务

# Midjourney
DOMAIN-SUFFIX,midjourney.com,AI服务

# ==================== Apple 服务 ====================
# Apple 系统更新（建议直连）
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/SystemOTA/SystemOTA.list,DIRECT,extended-matching

# Apple 服务
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Apple/Apple.list,Apple服务,extended-matching

# iCloud（建议直连或代理看个人需求）
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/iCloud/iCloud.list,Apple服务,extended-matching

# App Store
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/AppStore/AppStore.list,Apple服务,extended-matching

# TestFlight
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/TestFlight/TestFlight.list,Apple服务,extended-matching

# ==================== 社交通讯 ====================
# Telegram
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Telegram/Telegram.list,Telegram,extended-matching

# Twitter/X
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Twitter/Twitter.list,节点选择,extended-matching

# Discord
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Discord/Discord.list,节点选择,extended-matching

# ==================== 流媒体服务 ====================
# YouTube
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/YouTube/YouTube.list,国际媒体,extended-matching

# Netflix
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Netflix/Netflix.list,国际媒体,extended-matching

# Disney+
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Disney/Disney.list,国际媒体,extended-matching

# Spotify
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Spotify/Spotify.list,国际媒体,extended-matching

# TikTok
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/TikTok/TikTok.list,国际媒体,extended-matching


# ==================== 开发工具 ====================
# GitHub
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/GitHub/GitHub.list,节点选择,extended-matching

# GitLab
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/GitLab/GitLab.list,节点选择,extended-matching

# Docker
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Docker/Docker.list,节点选择,extended-matching

# ==================== 微软服务 ====================
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Microsoft/Microsoft.list,Microsoft,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/OneDrive/OneDrive.list,Microsoft,extended-matching

# ==================== Google 服务 ====================
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Google/Google.list,节点选择,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/GoogleDrive/GoogleDrive.list,节点选择,extended-matching

# ==================== 游戏平台 ====================
# Steam 中国
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/SteamCN/SteamCN.list,DIRECT,extended-matching
# Steam 国际
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Steam/Steam.list,游戏平台,extended-matching
# Epic
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Epic/Epic.list,游戏平台,extended-matching

# ==================== 下载工具直连 ====================
PROCESS-NAME,aria2c,DIRECT
PROCESS-NAME,fdm,DIRECT
PROCESS-NAME,Folx,DIRECT
PROCESS-NAME,NetTransport,DIRECT
PROCESS-NAME,Thunder,DIRECT
PROCESS-NAME,Transmission,DIRECT
PROCESS-NAME,uTorrent,DIRECT
PROCESS-NAME,WebTorrent,DIRECT
PROCESS-NAME,qbittorrent,DIRECT

# ==================== 国内服务直连 ====================
# 国内媒体
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/ChinaMedia/ChinaMedia.list,DIRECT,extended-matching

# 国内常用服务
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Weibo/Weibo.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/WeChat/WeChat.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Douyin/Douyin.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/BiliBili/BiliBili.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/NetEaseMusic/NetEaseMusic.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Zhihu/Zhihu.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Baidu/Baidu.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Alibaba/Alibaba.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Tencent/Tencent.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/ByteDance/ByteDance.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/JD/JD.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Sina/Sina.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/XiaoHongShu/XiaoHongShu.list,DIRECT,extended-matching

# 国内域名和 IP
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/China/China_Domain.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/China/China.list,DIRECT,extended-matching
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/ChinaIPs/ChinaIPs.list,DIRECT,extended-matching

# ==================== 系统规则 ====================
# 本地网络
RULE-SET,LAN,DIRECT

# GeoIP 中国
GEOIP,CN,DIRECT

# ==================== 兜底规则（白名单模式）====================
# 没有匹配到任何规则的流量走代理
FINAL,Final,dns-failed


# ============================================
# Host 映射
# ============================================
[Host]
# 路由器管理页面
amplifi.lan = server:syslib
router.synology.com = server:syslib
sila.razer.com = server:syslib
router.asus.com = server:syslib
routerlogin.net = server:syslib
orbilogin.com = server:syslib
www.LinksysSmartWiFi.com = server:syslib
LinksysSmartWiFi.com = server:syslib
myrouter.local = server:syslib
www.miwifi.com = server:syslib
miwifi.com = server:syslib
mediarouter.home = server:syslib
tplogin.cn = server:syslib
tplinklogin.net = server:syslib
melogin.cn = server:syslib
falogin.cn = server:syslib
*.lan = server:syslib

# ============================================
# URL 重写
# ============================================
[URL Rewrite]
# Google 搜索重定向（可选）
# ^https?://(www.)?g.cn https://www.google.com 302
# ^https?://(www.)?google.cn https://www.google.com 302

# Wikipedia 重定向到中文简体
^https?://zh.(m.)?wikipedia.org/(wiki|zh|zh-sg|zh-tw|zh-hans)/(.*) https://zh.wikipedia.org/zh-cn/$3 302

# ============================================
# Header 重写
# ============================================
[Header Rewrite]
# 无

# ============================================
# MITM (中间人攻击)
# ============================================
[MITM]
# 跳过服务端证书验证
skip-server-cert-verify = true

# 需要解密的域名
# hostname = 

# 排除的域名（AI 服务不解密，避免问题）
hostname = -generativelanguage.googleapis.com, -*.googleapis.com, -ai.google.dev, -*.google.dev, -api.openai.com, -*.openai.com, -claude.ai, -*.anthropic.com

# CA 证书（首次使用需要在 Surge 中生成并安装）
# ca-passphrase = 
# ca-p12 = 

# ============================================
# 脚本
# ============================================
[Script]
# 可以在这里添加自定义脚本
# 例如：签到脚本、解锁脚本等

# ============================================
# 面板
# ============================================
[Panel]
# 网络信息面板
network-info = script-name=network-info, update-interval=1

# ============================================
# 使用说明
# ============================================
#
# 📱 iPhone 使用方法：
# 1. 将此配置文件上传到 iCloud 或通过 URL 导入
# 2. 在 Surge iOS 中导入配置
# 3. 首次使用需要安装 CA 证书（设置 > 通用 > 关于本机 > 证书信任设置）
# 4. 启用 Surge 即可
#
# 💻 Mac 使用方法：
# 1. 将此配置文件放入 ~/Library/Application Support/Surge/Profiles/
# 2. 或通过 Surge Mac 直接导入
# 3. 首次使用需要安装 CA 证书
# 4. 启用增强模式以获得最佳体验
#
# 🔄 iCloud 同步：
# 1. 在 Surge iOS 和 Mac 中都启用 iCloud 同步
# 2. 配置文件会自动在设备间同步
#
# ⚠️ 注意事项：
# 1. 首次使用需要在 Surge 中生成 CA 证书并安装信任
# 2. 订阅地址请替换为你自己的 Sub-Store 地址
# 3. 规则集会自动更新，无需手动维护
# 4. 如遇到某些网站无法访问，可以手动添加规则
#
# 🛠️ 自定义修改：
# 1. 节点选择：修改 [Proxy Group] 中的策略组
# 2. 分流规则：修改 [Rule] 中的规则顺序和策略
# 3. AI 服务：默认走美国节点，可在 AI服务 策略组中切换
# 4. 广告拦截：默认开启，可在 广告拦截 策略组中关闭
#
# 📊 策略组说明：
# - 节点选择：主要代理策略，手动选择
# - 自动选择：自动测速选择最快节点
# - AI服务：ChatGPT/Claude/Gemini 等 AI 服务
# - Apple服务：Apple 相关服务
# - 国际媒体：YouTube/Netflix 等流媒体
# - Telegram：电报消息
# - Microsoft：微软服务
# - 游戏平台：Steam/Epic 等游戏平台
# - 广告拦截：广告和隐私追踪拦截
# - Final：兜底策略，未匹配规则的流量
#
# 🌐 地区节点组：
# - 香港节点：适合访问港区服务
# - 台湾节点：适合访问台区服务
# - 日本节点：适合访问日区服务、游戏
# - 新加坡节点：适合访问东南亚服务
# - 美国节点：适合 AI 服务、美区服务
