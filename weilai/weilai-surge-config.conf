# è”šæ¥å…¨è‡ªåŠ¨ç­¾åˆ° - Surge å®Œæ•´é…ç½®æ–‡ä»¶
# å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„ Surge é…ç½®æ–‡ä»¶ä¸­

[Rule]
# ==================== Google AI è·¯ç”±è§„åˆ™ ====================

# Google AI Studio å’Œ Gemini API ç›¸å…³åŸŸåèµ°ç¾å›½èŠ‚ç‚¹
DOMAIN-SUFFIX,generativelanguage.googleapis.com,ç¾å›½èŠ‚ç‚¹
DOMAIN-SUFFIX,ai.google.dev,ç¾å›½èŠ‚ç‚¹
DOMAIN-SUFFIX,aistudio.google.com,ç¾å›½èŠ‚ç‚¹
DOMAIN-SUFFIX,makersuite.google.com,ç¾å›½èŠ‚ç‚¹
DOMAIN-SUFFIX,bard.google.com,ç¾å›½èŠ‚ç‚¹

# Google AI ç›¸å…³ IP æ®µï¼ˆå¦‚æœéœ€è¦æ›´ç²¾ç¡®æ§åˆ¶ï¼‰
# IP-CIDR,142.250.0.0/15,ç¾å›½èŠ‚ç‚¹
# IP-CIDR,172.217.0.0/16,ç¾å›½èŠ‚ç‚¹
# IP-CIDR,216.58.192.0/19,ç¾å›½èŠ‚ç‚¹

[Script]
# ==================== è”šæ¥å…¨è‡ªåŠ¨ç­¾åˆ°è„šæœ¬ ====================

# Tokenè‡ªåŠ¨æŠ“å– - æ‹¦æˆªè”šæ¥APPçš„æ‰€æœ‰è¯·æ±‚ï¼Œè‡ªåŠ¨æå–å¹¶ä¿å­˜token
è”šæ¥TokenæŠ“å– = type=http-request,pattern=^https://(gateway-front-external\.nio\.com|app\.nio\.com|api\.nio\.com)/.*,script-path=weilai-auto-checkin.js,timeout=10

# å®šæ—¶ç­¾åˆ°ä»»åŠ¡ - æ¯å¤©æ—©ä¸Š9ç‚¹è‡ªåŠ¨ç­¾åˆ°
è”šæ¥è‡ªåŠ¨ç­¾åˆ° = type=cron,cronexp=0 9 * * *,script-path=weilai-auto-checkin.js,timeout=30,wake-system=1

# æ‰‹åŠ¨ç­¾åˆ° - è®¿é—®æŒ‡å®šURLæ‰‹åŠ¨è§¦å‘ç­¾åˆ°
è”šæ¥æ‰‹åŠ¨ç­¾åˆ° = type=http-request,pattern=^https://manual-checkin\.test$,script-path=weilai-auto-checkin.js,timeout=30

# TokençŠ¶æ€æ£€æŸ¥ - æ£€æŸ¥å½“å‰tokençŠ¶æ€
è”šæ¥TokençŠ¶æ€ = type=http-request,pattern=^https://token-status\.test$,script-path=weilai-token-capture.js,timeout=10

[MITM]
# ==================== HTTPS è§£å¯†é…ç½® ====================

# è”šæ¥ç›¸å…³åŸŸå - å¿…é¡»æ·»åŠ ä»¥ä¸‹åŸŸåæ‰èƒ½æ‹¦æˆªtoken
hostname = gateway-front-external.nio.com, app.nio.com, api.nio.com

[URL Rewrite]
# ==================== URLé‡å†™è§„åˆ™ï¼ˆå¯é€‰ï¼‰====================

# æ–¹ä¾¿æ‰‹åŠ¨è§¦å‘çš„é‡å†™è§„åˆ™
^https://weilai\.checkin$ https://manual-checkin.test 302
^https://weilai\.token$ https://token-status.test 302

# ==================== ä½¿ç”¨è¯´æ˜ ====================
# 
# ğŸš€ å¿«é€Ÿå¼€å§‹ï¼š
# 1. å°†ä¸Šè¿°é…ç½®æ·»åŠ åˆ°Surgeé…ç½®æ–‡ä»¶
# 2. é‡å¯Surgeæˆ–é‡æ–°åŠ è½½é…ç½®
# 3. æ‰“å¼€è”šæ¥APPï¼Œè¿›è¡Œä»»æ„æ“ä½œï¼ˆæµè§ˆã€ç­¾åˆ°ç­‰ï¼‰
# 4. è„šæœ¬ä¼šè‡ªåŠ¨æŠ“å–å¹¶ä¿å­˜token
# 5. ç¬¬äºŒå¤©æ—©ä¸Š9ç‚¹ä¼šè‡ªåŠ¨ç­¾åˆ°
#
# ğŸ”§ æ‰‹åŠ¨æ“ä½œï¼š
# - æ‰‹åŠ¨ç­¾åˆ°ï¼šSafariè®¿é—® https://weilai.checkin æˆ– https://manual-checkin.test
# - æ£€æŸ¥Tokenï¼šSafariè®¿é—® https://weilai.token æˆ– https://token-status.test
#
# â° å®šæ—¶ä»»åŠ¡é…ç½®ï¼š
# - 0 9 * * *   : æ¯å¤©æ—©ä¸Š9ç‚¹æ‰§è¡Œ
# - 0 8 * * *   : æ¯å¤©æ—©ä¸Š8ç‚¹æ‰§è¡Œ  
# - 0 22 * * *  : æ¯å¤©æ™šä¸Š10ç‚¹æ‰§è¡Œ
# - æ ¼å¼ï¼šåˆ† æ—¶ æ—¥ æœˆ å‘¨
#
# ğŸ¯ Tokenè‡ªåŠ¨ç®¡ç†ï¼š
# - è„šæœ¬ä¼šè‡ªåŠ¨æ‹¦æˆªè”šæ¥APPçš„è¯·æ±‚
# - è‡ªåŠ¨æå–å¹¶ä¿å­˜Authorization token
# - Tokenæœ‰æ•ˆæœŸ30å¤©ï¼Œè¿‡æœŸä¼šè‡ªåŠ¨æé†’
# - æ— éœ€æ‰‹åŠ¨é…ç½®tokenï¼Œå®Œå…¨è‡ªåŠ¨åŒ–
#
# ğŸ“± æ”¯æŒçš„æ“ä½œï¼š
# - åœ¨è”šæ¥APPä¸­ç­¾åˆ°
# - æµè§ˆè”šæ¥APPä»»æ„é¡µé¢
# - æŸ¥çœ‹ä¸ªäººä¿¡æ¯
# - ä½¿ç”¨è”šæ¥APPçš„ä»»ä½•åŠŸèƒ½
#
# âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
# - é¦–æ¬¡ä½¿ç”¨éœ€è¦åœ¨è”šæ¥APPä¸­è¿›è¡Œæ“ä½œä»¥è·å–token
# - ç¡®ä¿Surgeçš„MITMåŠŸèƒ½å·²å¼€å¯
# - ç¡®ä¿å·²å®‰è£…å¹¶ä¿¡ä»»Surgeçš„CAè¯ä¹¦
# - Tokenä¼šè‡ªåŠ¨ä¿å­˜åœ¨æœ¬åœ°ï¼Œæ— éœ€æ‹…å¿ƒä¸¢å¤±
#
# ğŸ” æ•…éšœæ’é™¤ï¼š
# - å¦‚æœç­¾åˆ°å¤±è´¥ï¼Œæ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ
# - å¦‚æœtokenè·å–å¤±è´¥ï¼Œæ£€æŸ¥MITMé…ç½®
# - æŸ¥çœ‹Surgeæ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
# - å¯ä»¥æ‰‹åŠ¨è®¿é—®tokençŠ¶æ€é¡µé¢æ£€æŸ¥

# ==================== é«˜çº§é…ç½®ï¼ˆå¯é€‰ï¼‰====================

# å¦‚æœéœ€è¦æ›´ç²¾ç¡®çš„æ‹¦æˆªï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è§„åˆ™æ›¿æ¢ä¸Šé¢çš„TokenæŠ“å–è§„åˆ™ï¼š
# è”šæ¥TokenæŠ“å–-ç²¾ç¡® = type=http-request,pattern=^https://gateway-front-external\.nio\.com/moat/\d+/c/award_cn/.*,script-path=weilai-auto-checkin.js,timeout=10

# å¦‚æœéœ€è¦è°ƒè¯•æ¨¡å¼ï¼Œå¯ä»¥æ·»åŠ ï¼š
# è”šæ¥è°ƒè¯•æ¨¡å¼ = type=http-request,pattern=^https://debug-weilai\.test$,script-path=weilai-auto-checkin.js,timeout=30,debug=1